clear all
close all

%%%%%%%%%%%%%%%FIGURE 1%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Initial Conditions
P(1) = 0.163;

%Parameters
k=0.3;
a=0.0;
t=1.0;
c=0.03;
s=0.8;

%Generations
tmax=500;

%Model
% for x = 1:tmax
%     for m = [0,1e-10,1e-6,1e-4]
%         q=1-P(x);
%         N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
%         P(x+1) = P(x).*(1-c-s.*(1-t)+N(x+1).*s.*(k-a-t))./(1-s+N(x+1).*k.*s+(1-q.^2).*(t.*s-c-N(x+1).*s.*(a+t)));
%         Q(x) = 1-P(x); 
%         N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
%         Q(x+1) = Q(x)+m.*(1-2.*Q(x));
%         plot(N,Q,'k')
%         xlim([0 1]), ylim([0 1])
%     end
% end


%FIGURE 1A
for x = 1:tmax
    N(1) = 0.001;
    Q(1) = 0.999;
    m = 0;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x+1).*s.*(k-a-t))./(1-s+N(x+1).*k.*s+(1-q.^2).*(t.*s-c-N(x+1).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(1)
    subplot(2,2,1)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end
%FIGURE 1B
for x = 1:tmax
    N(1) = 0.001;
    Q(1) = 0.999;
    m = 1e-10;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x+1).*s.*(k-a-t))./(1-s+N(x+1).*k.*s+(1-q.^2).*(t.*s-c-N(x+1).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(1)
    subplot(2,2,2)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end
%FIGURE 1C
for x = 1:tmax
    N(1) = 0.001;
    Q(1) = 0.999;
    m = 1e-6;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x+1).*s.*(k-a-t))./(1-s+N(x+1).*k.*s+(1-q.^2).*(t.*s-c-N(x+1).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(1)
    subplot(2,2,3)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end
%FIGURE 1D
for x = 1:tmax
    N(1) = 0.001;
    Q(1) = 0.999;
    m = 1e-4;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x+1).*s.*(k-a-t))./(1-s+N(x+1).*k.*s+(1-q.^2).*(t.*s-c-N(x+1).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(1)
    subplot(2,2,4)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%FIGURE 1%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%FIGURE 2%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%FIGURE 2A
for x = 1:tmax
    N(1) = 0.9;
    Q(1) = 0.9;
    m=0;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x).*s.*(k-a-t))./(1-s+N(x).*k.*s+(1-q.^2).*(t.*s-c-N(x).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(2)
    subplot(2,2,1)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end
%FIGURE 2B
for x = 1:tmax
    N(1) = 0.001;
    Q(1) = 0.999;
    m=1e-4;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x).*s.*(k-a-t))./(1-s+N(x).*k.*s+(1-q.^2).*(t.*s-c-N(x).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(2)
    subplot(2,2,2)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end
%FIGURE 2C
for x = 1:tmax
    N(1) = 0.9;
    Q(1) = 0.9;
    m=1e-4;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x).*s.*(k-a-t))./(1-s+N(x).*k.*s+(1-q.^2).*(t.*s-c-N(x).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(2)
    subplot(2,2,3)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end
%FIGURE 2D
for x = 1:tmax
    N(1) = 0.001;
    Q(1) = 0.999;
    m=1e-10;
    q=1-P(x);
    N(x+1) = (N(x).*(1-k+(1-q.^2).*a))./(1-(1-q.^2).*t+N(x).*((1-q.^2).*(a+t)-k));
    P(x+1) = P(x).*(1-c-s.*(1-t)+N(x).*s.*(k-a-t))./(1-s+N(x).*k.*s+(1-q.^2).*(t.*s-c-N(x).*s.*(a+t)));
    Q(x) = 1-P(x); 
    N(x+1) = N(x+1)+m.*(1-2.*N(x+1));
    Q(x+1) = Q(x)+m.*(1-2.*Q(x));
    figure(2)
    subplot(2,2,4)
    plot(N,Q,'k')
    xlim([0 1]), ylim([0 1])
end